{"version":3,"file":"DatadogLoggingService.js","names":["_browserRum","require","_browserLogs","_typeof","o","Symbol","iterator","constructor","prototype","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","key","value","_toPropertyKey","configurable","writable","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","descriptor","_createClass","protoProps","staticProps","_toPrimitive","toPrimitive","call","String","Number","browserLogNameIgnoredError","sendBrowserLog","actionName","message","customAttributes","process","env","NODE_ENV","console","log","datadogLogs","logger","info","concat","sendError","error","DatadogLoggingService","options","config","undefined","ignoredErrorRegexes","IGNORED_ERROR_REGEX","initialize","beforeSend","requiredDatadogConfig","DATADOG_APPLICATION_ID","DATADOG_CLIENT_TOKEN","hasRequiredDatadogConfig","every","datadogVersion","DATADOG_VERSION","APP_VERSION","datadogRum","init","applicationId","clientToken","site","DATADOG_SITE","service","DATADOG_SERVICE","DATADOG_ENV","version","sessionSampleRate","parseInt","DATADOG_SESSION_SAMPLE_RATE","sessionReplaySampleRate","DATADOG_SESSION_REPLAY_SAMPLE_RATE","trackUserInteractions","trackResources","trackLongTasks","defaultPrivacyLevel","forwardErrorsToLogs","DATADOG_LOGS_SESSION_SAMPLE_RATE","logInfo","infoStringOrErrorObject","customAttrs","infoCustomAttributes","logError","errorStringOrObject","errorCustomAttributes","allCustomAttributes","errorMessage","match","setCustomAttribute","name","setUserProperty","setGlobalContextProperty","_default","exports"],"sources":["../src/DatadogLoggingService.js"],"sourcesContent":["import { datadogRum } from '@datadog/browser-rum';\nimport { datadogLogs } from '@datadog/browser-logs';\n\nconst browserLogNameIgnoredError = 'IGNORED_ERROR';\n\nfunction sendBrowserLog(actionName, message, customAttributes) {\n  if (process.env.NODE_ENV === 'development') {\n    console.log(actionName, message, customAttributes); // eslint-disable-line\n  }\n  datadogLogs.logger.info(`${actionName}: ${message}`, customAttributes);\n}\n\nfunction sendError(error, customAttributes) {\n  if (process.env.NODE_ENV === 'development') {\n    console.error(error, customAttributes); // eslint-disable-line\n  }\n  // https://docs.datadoghq.com/logs/log_collection/javascript/#error-tracking\n  datadogLogs.logger.error(error, customAttributes);\n}\n\nclass DatadogLoggingService {\n  constructor(options) {\n    const config = options ? options.config : undefined;\n    this.ignoredErrorRegexes = config ? config.IGNORED_ERROR_REGEX : undefined;\n    this.initialize();\n  }\n\n  // to read more about the use cases for beforeSend, refer to the documentation:\n  // https://docs.datadoghq.com/real_user_monitoring/guide/enrich-and-control-rum-data/?tab=event#event-and-context-structure\n  // (e.g., discarding frontend errors matching the optional `IGNORED_ERROR_REGEX` configuration,\n  // currently implemented in `logError` below).\n  beforeSend() {\n    // common/shared logic across all MFEs\n    return true;\n  }\n\n  initialize() {\n    const requiredDatadogConfig = [\n      process.env.DATADOG_APPLICATION_ID,\n      process.env.DATADOG_CLIENT_TOKEN,\n    ];\n    const hasRequiredDatadogConfig = requiredDatadogConfig.every(value => !!value);\n\n    // Do not attempt to initialize Datadog if required config settings are not supplied.\n    if (!hasRequiredDatadogConfig) {\n      return;\n    }\n\n    const datadogVersion = process.env.DATADOG_VERSION || process.env.APP_VERSION || '1.0.0';\n    datadogRum.init({\n      applicationId: process.env.DATADOG_APPLICATION_ID,\n      beforeSend: this.beforeSend,\n      clientToken: process.env.DATADOG_CLIENT_TOKEN,\n      site: process.env.DATADOG_SITE || '',\n      service: process.env.DATADOG_SERVICE || '',\n      env: process.env.DATADOG_ENV || '',\n      version: datadogVersion,\n      sessionSampleRate: parseInt(process.env.DATADOG_SESSION_SAMPLE_RATE || 0, 10),\n      sessionReplaySampleRate: parseInt(process.env.DATADOG_SESSION_REPLAY_SAMPLE_RATE || 0, 10),\n      trackUserInteractions: true,\n      trackResources: true,\n      trackLongTasks: true,\n      defaultPrivacyLevel: 'mask-user-input',\n    });\n    datadogLogs.init({\n      clientToken: process.env.DATADOG_CLIENT_TOKEN,\n      site: process.env.DATADOG_SITE || '',\n      env: process.env.DATADOG_ENV || '',\n      forwardErrorsToLogs: true,\n      sessionSampleRate: parseInt(process.env.DATADOG_LOGS_SESSION_SAMPLE_RATE || 0, 10),\n      service: process.env.DATADOG_SERVICE || '',\n      version: datadogVersion,\n    });\n  }\n\n  logInfo(infoStringOrErrorObject, customAttributes = {}) {\n    let message = infoStringOrErrorObject;\n    let customAttrs = { ...customAttributes };\n    if (typeof infoStringOrErrorObject === 'object' && 'message' in infoStringOrErrorObject) {\n      const infoCustomAttributes = infoStringOrErrorObject.customAttributes || {};\n      customAttrs = { ...infoCustomAttributes, ...customAttributes };\n      message = infoStringOrErrorObject.message;\n    }\n    datadogLogs.logger.info(message, customAttrs);\n  }\n\n  /**\n   *\n   *\n   * @param {*} errorStringOrObject\n   * @param {*} [customAttributes={}]\n   * @memberof DatadogLoggingService\n   */\n  logError(errorStringOrObject, customAttributes = {}) {\n    const errorCustomAttributes = errorStringOrObject.customAttributes || {};\n    let allCustomAttributes = { ...errorCustomAttributes, ...customAttributes };\n    if (Object.keys(allCustomAttributes).length === 0) {\n      allCustomAttributes = undefined;\n    }\n\n    /*\n        Separate the errors into ignored errors and other errors.\n        Ignored errors are logged as it is.\n        Other errors are logged via error API.\n    */\n    const errorMessage = errorStringOrObject.message || (typeof errorStringOrObject === 'string' ? errorStringOrObject : '');\n    if (this.ignoredErrorRegexes && errorMessage.match(this.ignoredErrorRegexes)) {\n      /* ignored error */\n      sendBrowserLog(browserLogNameIgnoredError, errorMessage, allCustomAttributes);\n    } else {\n      /*  error! */\n      sendError(errorStringOrObject, allCustomAttributes);\n    }\n  }\n\n  /**\n   * Sets a custom attribute that will be included with all subsequent log messages.\n   *\n   * @param {string} name\n   * @param {string|number|null} value\n   */\n  setCustomAttribute(name, value) {\n    if (name === 'userId') {\n      datadogLogs.setUserProperty('id', value);\n      datadogRum.setUserProperty('id', value);\n      return;\n    }\n    datadogLogs.setGlobalContextProperty(name, value);\n    datadogRum.setGlobalContextProperty(name, value);\n  }\n}\n\nexport default DatadogLoggingService;\n"],"mappings":"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","ignoreList":[]}